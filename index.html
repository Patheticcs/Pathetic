<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key System</title>
    <meta name="description" content="We're a passionate team focused on creating reliable, effective tools to enhance your gaming and online experiences. We prioritize quality and ease of use, ensuring every solution we offer meets the highest standards to help you get the most out of your online activities.">
    <meta property="og:title" content="Pathetic">
    <meta property="og:description" content="Discover effective tools that enhance your gaming and online experiences. Prioritizing quality and ease of use, we deliver solutions that empower your digital journey.">
    <meta property="og:image" content="/favicon">
    <meta property="og:url" content="https://pathetic.one">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Pathetic">
    <meta property="og:locale" content="en_US">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px)
        }

        to {
          opacity: 1;
          transform: translateY(0)
        }
      }

      @keyframes gradientMove {
        0% {
          background-position: 0 50%
        }

        50% {
          background-position: 100% 50%
        }

        100% {
          background-position: 0 50%
        }
      }

      @keyframes glowPulse {

        0%,
        100% {
          box-shadow: 0 0 20px rgba(255, 255, 255, .2)
        }

        50% {
          box-shadow: 0 0 40px rgba(255, 255, 255, .4)
        }
      }

      @keyframes borderFlow {
        0% {
          background-position: 0 0
        }

        100% {
          background-position: 200% 0
        }
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0, #c3cfe2 100%);
        min-height: 100vh;
        display: flex;
        color: #2d3436;
        min-height: 100vh;
        justify-content: center;
        align-items: center;
        margin: 0;
        overflow: hidden;
        position: relative
      }

      .glass-overlay {
        position: fixed;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle at center, transparent 0, rgba(0, 0, 0, .4) 100%);
        pointer-events: none;
        z-index: 1
      }

      .container {
        border-radius: 40px;
        background: rgba(255, 255, 255, .25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, .3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, .3);
        text-align: center;
        transition: all .5s ease-out;
        min-height: 450px;
        width: 650px;
        position: relative;
        overflow: hidden
      }

      .container::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(120deg, transparent, rgba(255, 255, 255, .3), transparent);
        transition: .5s
      }

      .container:hover::before {
        left: 100%
      }

      h2 {
        font-size: 3.2em;
        margin-top: 50px;
        color: #000;
        margin-bottom: 1.5em;
        text-align: center;
        position: relative;
        text-transform: uppercase;
        letter-spacing: 3px;
        text-shadow: 0 0 10px rgba(255, 255, 255, .3);
        animation: fadeIn .8s ease-out .2s backwards
      }

      .input-group {
        position: relative;
        margin: 2em 0;
        animation: fadeIn .8s ease-out .4s backwards
      }

      input[type=text] {
        margin-top: 0;
        width: 80%;
        padding: 15px 20px;
        font-size: 1em;
        background: rgba(255, 255, 255, .07);
        border: 1px solid rgba(0, 0, 0, .1);
        border-radius: 15px;
        color: #000;
        outline: 0;
        transition: all .3s cubic-bezier(.4, 0, .2, 1)
      }

      input[type=text]:hover {
        background: rgba(255, 255, 255, .09);
        box-shadow: 0 0 20px rgba(0, 0, 0, .1)
      }

      input[type=text]:focus {
        border-color: rgba(0, 0, 0, .3);
        background: rgba(255, 255, 255, .11);
        box-shadow: 0 0 25px rgba(0, 0, 0, .2)
      }

      .button-group {
        display: flex;
        gap: 1.5em;
        justify-content: center;
        margin-top: 2em;
        animation: fadeIn .8s ease-out .6s backwards
      }

      button {
        padding: 12px 30px;
        border: none;
        border-radius: 12px;
        background: rgba(255, 255, 255, .1);
        color: #000;
        font-size: 1em;
        cursor: pointer;
        transition: all .3s cubic-bezier(.4, 0, .2, 1);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(0, 0, 0, .1);
        position: relative;
        margin-top: 40px;
        overflow: hidden
      }

      button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .2), transparent);
        transition: .5s
      }

      button:hover {
        background: rgba(255, 255, 255, .15);
        box-shadow: 0 0 15px rgba(0, 0, 0, .1)
      }

      button:hover::before {
        left: 100%
      }

      button i {
        margin-right: 8px;
        transition: transform .3s ease
      }

      button:hover i {
        transform: scale(1.2)
      }

      .alert {
        margin-top: 1.5em;
        padding: 1px;
        height: 50px;
        width: 500px;
        border-radius: 12px;
        background: rgba(255, 59, 48, .15);
        color: rgba(255, 255, 255, .9);
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transform: translateY(-10px);
        max-height: 0;
        overflow: hidden;
        margin-left: 75px;
        transition: all .3s cubic-bezier(.4, 0, .2, 1);
        backdrop-filter: blur(5px);
        margin-bottom: 20px
      }

      .alert.show {
        opacity: 1;
        transform: translateY(0);
        max-height: 100px
      }

      @keyframes shake {

        0%,
        100% {
          transform: translateX(0)
        }

        25% {
          transform: translateX(-10px)
        }

        75% {
          transform: translateX(10px)
        }
      }

      .shake {
        animation: shake .5s cubic-bezier(.36, .07, .19, .97) both
      }
    </style>
  </head>
  <body>
    <div class="glass-overlay"></div>
    <div class="container" id="login-container">
      <div class="content-wrapper">
        <h2>Key System</h2>
        <div class="input-group">
          <input type="text" id="key" placeholder="Enter your access key" autocomplete="off">
        </div>
        <div class="button-group">
          <button id="submitBtn" type="button">
            <i class="fas fa-key"></i>Submit
          </button>
          <button id="discordBtn" type="button">
            <i class="fab fa-discord"></i>Get Key
          </button>
        </div>
        <div id="alert" class="alert"></div>
      </div>
    </div>
    <script>
      class KeySystem {
        constructor() {
          this.submitBtn = document.getElementById('submitBtn');
          this.discordBtn = document.getElementById('discordBtn');
          this.keyInput = document.getElementById('key');
          this.alert = document.getElementById('alert');
          this.container = document.getElementById('login-container');

          this.initEventListeners();
          this.checkExistingSession();
        }

        initEventListeners() {
          this.submitBtn.addEventListener('click', () => this.validateKey());
          this.discordBtn.addEventListener('click', () => this.openDiscord());
          this.keyInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.validateKey();
          });

          this.attempts = 0;
          this.lastAttemptTime = 0;
        }

        async validateKey() {
          const key = this.keyInput.value.trim();

          if (!key || key.length < 8) {
            this.showAlert('Please enter a valid key', 'error');
            return;
          }

          const now = Date.now();
          if (now - this.lastAttemptTime < 2000) {
            this.showAlert('Please wait before trying again', 'error');
            return;
          }
          if (this.attempts >= 5) {
            this.showAlert('Too many attempts. Please try again later', 'error');
            return;
          }

          this.attempts++;
          this.lastAttemptTime = now;

          this.submitBtn.disabled = true;

          try {
            const isValid = await this.checkKeyValidity(key);
            if (isValid) {
              this.handleSuccessfulLogin(key);
            } else {
              this.handleFailedLogin();
            }
          } catch (error) {
            this.showAlert('Error validating key. Please try again', 'error');
          } finally {
            this.submitBtn.disabled = false;
          }
        }

        async checkKeyValidity(key) {
          try {
            const response = await fetch('/api/validate-key', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
              },
              body: JSON.stringify({ key: key })
            });

            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            return data.valid;
          } catch (error) {
            console.error('Error:', error);
            return false;
          }
        }

        handleSuccessfulLogin(key) {
          this.showAlert('Success! Redirecting...', 'success');

          const session = {
            key: key,
            timestamp: Date.now(),
            expires: Date.now() + (24 * 60 * 60 * 1000) 
          };

          try {
            sessionStorage.setItem('session', JSON.stringify(session));
            setTimeout(() => window.location.href = '/home', 1500);
          } catch (error) {
            console.error('Error storing session:', error);
            this.showAlert('Error establishing session', 'error');
          }
        }

        handleFailedLogin() {
          this.showAlert('Invalid key! Please try again or get a new key', 'error');
          this.container.classList.add('shake');
          setTimeout(() => this.container.classList.remove('shake'), 500);
          this.keyInput.value = '';
        }

        showAlert(message, type) {
          this.alert.textContent = message;
          this.alert.style.background = type === 'success' ? 
            'rgba(48, 209, 88, 0.15)' : 
            'rgba(255, 59, 48, 0.15)';
          this.alert.classList.add('show');
          this.container.style.height = 'auto';
        }

        openDiscord() {
          const discordURL = 'https://discord.gg/Eg2EWXwYcn';
          window.open(discordURL, '_blank', 'noopener,noreferrer');
        }

        checkExistingSession() {
          try {
            const sessionData = sessionStorage.getItem('session');
            if (!sessionData) return;

            const session = JSON.parse(sessionData);
            if (Date.now() > session.expires) {
              sessionStorage.removeItem('session');
              this.showAlert('Session expired. Please enter a new key', 'error');
              return;
            }

            this.checkKeyValidity(session.key).then(isValid => {
              if (isValid) {
                window.location.href = '/home.html';
              } else {
                sessionStorage.removeItem('session');
                this.showAlert('Session invalid. Please enter a new key', 'error');
              }
            });
          } catch (error) {
            console.error('Error checking session:', error);
            sessionStorage.removeItem('session');
          }
        }
      }

      document.addEventListener('DOMContentLoaded', () => new KeySystem());
    </script>
  </body>
</html>
